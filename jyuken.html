<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å­¦ãƒ¬ãƒ™ãƒ« å¿…é ˆå˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§</title>
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Howler.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <!-- canvas-confetti for confetti effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        h1 { font-size: 24px; }
        p { font-size: 16px; }
        .search-container { margin: 20px 0; }
        .search-container input { padding: 8px; width: 300px; font-size: 16px; }
        .nav-tabs { justify-content: center; margin: 20px 0; }
        .nav-link { font-size: 18px; }
        table { width: 80%; margin: 10px auto; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        td:hover { background-color: #f9f9f9; cursor: pointer; }
        .quiz-container { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); z-index: 1000; width: 400px; }
        .quiz-container.active { display: block; }
        .quiz-container p { font-size: 18px; margin-bottom: 20px; }
        .quiz-option { margin: 5px; padding: 10px; font-size: 16px; width: 100%; }
        .quiz-option.correct { background-color: #d4edda; }
        .quiz-option.incorrect { background-color: #f8d7da; }
        .quiz-option.selected { background-color: #e0e0e0; }
        .quiz-feedback { font-size: 16px; font-weight: bold; margin: 10px 0; }
        .effect-overlay { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; z-index: 2000; }
        .effect-overlay.correct { color: green; }
        .effect-overlay.wrong { color: red; }
        .heart { position: fixed; font-size: 24px; z-index: 1500; }
        .bone-attack { position: absolute; font-size: 30px; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1500; }
        footer { margin-top: 20px; font-size: 14px; }
        .tab-pane { max-height: 600px; overflow-y: auto; }
        #loadingModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; z-index: 1000; }
        #loadingModal.active { display: block; }
    </style>
</head>
<body>
    <h1>ä¸­å­¦ãƒ¬ãƒ™ãƒ« å¿…é ˆå˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§</h1>
    <p>ä¸­å­¦ãƒ¬ãƒ™ãƒ«ã«ç‰¹åŒ–ã—ãŸ1555èª/ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆå˜èªã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç™ºéŸ³å†ç”Ÿã€æ¤œç´¢ãƒ»ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ä»˜ãï¼‰</p>

    <div id="loadingModal" class="active">
        <p>Loading...</p>
    </div>

    <div class="search-container">
        <input type="text" id="search" class="form-control mx-auto" placeholder="å˜èªã‚„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’æ¤œç´¢..." oninput="searchWords()">
    </div>

    <button class="btn btn-primary" onclick="startQuiz()">ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹</button>

    <!-- Bootstrap Tabs -->
    <ul class="nav nav-tabs" id="wordTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="nouns-tab" data-bs-toggle="tab" data-bs-target="#nouns" type="button" role="tab" aria-controls="nouns" aria-selected="true">åè©</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="verbs-tab" data-bs-toggle="tab" data-bs-target="#verbs" type="button" role="tab" aria-controls="verbs" aria-selected="false">å‹•è©</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="adjectives-tab" data-bs-toggle="tab" data-bs-target="#adjectives" type="button" role="tab" aria-controls="adjectives" aria-selected="false">å½¢å®¹è©</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="adverbs-tab" data-bs-toggle="tab" data-bs-target="#adverbs" type="button" role="tab" aria-controls="adverbs" aria-selected="false">å‰¯è©</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="prepositions-tab" data-bs-toggle="tab" data-bs-target="#prepositions" type="button" role="tab" aria-controls="prepositions" aria-selected="false">å‰ç½®è©</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="phrases-tab" data-bs-toggle="tab" data-bs-target="#phrases" type="button" role="tab" aria-controls="phrases" aria-selected="false">ç†Ÿèªãƒ»ãƒ•ãƒ¬ãƒ¼ã‚º</button>
        </li>
    </ul>

    <div class="tab-content" id="wordTabsContent">
        <div class="tab-pane fade show active" id="nouns" role="tabpanel" aria-labelledby="nouns-tab">
            <h2>åè©ï¼ˆ900èªï¼‰</h2>
            <table id="nouns-table">
                <tr><th>è‹±å˜èª</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨900èªï¼ˆæŒ‡å°è¦é ˜488èªï¼‹è‡ªç„¶ãƒ»é‡èœé–¢é€£244èªï¼‹è¿½åŠ 168èªï¼‰ã€‚å‡ºå…¸ï¼šæ–‡éƒ¨ç§‘å­¦çœã€è‹±å˜èªæ¤œå®šã€‚</p>
        </div>
        <div class="tab-pane fade" id="verbs" role="tabpanel" aria-labelledby="verbs-tab">
            <h2>å‹•è©ï¼ˆ150èªï¼‰</h2>
            <table id="verbs-table">
                <tr><th>è‹±å˜èª</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨150èªï¼ˆæŒ‡å°è¦é ˜41èªï¼‹è¿½åŠ 109èªï¼‰ã€‚</p>
        </div>
        <div class="tab-pane fade" id="adjectives" role="tabpanel" aria-labelledby="adjectives-tab">
            <h2>å½¢å®¹è©ï¼ˆ200èªï¼‰</h2>
            <table id="adjectives-table">
                <tr><th>è‹±å˜èª</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨200èªï¼ˆæŒ‡å°è¦é ˜60èªï¼‹è¿½åŠ 140èªï¼‰ã€‚</p>
        </div>
        <div class="tab-pane fade" id="adverbs" role="tabpanel" aria-labelledby="adverbs-tab">
            <h2>å‰¯è©ï¼ˆ80èªï¼‰</h2>
            <table id="adverbs-table">
                <tr><th>è‹±å˜èª</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨80èªï¼ˆæŒ‡å°è¦é ˜20èªï¼‹è¿½åŠ 60èªï¼‰ã€‚</p>
        </div>
        <div class="tab-pane fade" id="prepositions" role="tabpanel" aria-labelledby="prepositions-tab">
            <h2>å‰ç½®è©ï¼ˆ50èªï¼‰</h2>
            <table id="prepositions-table">
                <tr><th>è‹±å˜èª</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨50èªï¼ˆæŒ‡å°è¦é ˜20èªï¼‹è¿½åŠ 30èªï¼‰ã€‚</p>
        </div>
        <div class="tab-pane fade" id="phrases" role="tabpanel" aria-labelledby="phrases-tab">
            <h2>ç†Ÿèªãƒ»ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆ175å€‹ï¼‰</h2>
            <table id="phrases-table">
                <tr><th>ãƒ•ãƒ¬ãƒ¼ã‚º</th><th>æ„å‘³</th></tr>
            </table>
            <p>æ³¨ï¼šå…¨175ãƒ•ãƒ¬ãƒ¼ã‚ºï¼ˆæŒ‡å°è¦é ˜50ï¼‹è¿½åŠ 125ï¼‰ã€‚ã‚¤ã‚®ãƒªã‚¹è‹±èªã®æŒ¨æ‹¶ã‚„è‡ªç„¶é–¢é€£ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è¿½åŠ ã€‚</p>
        </div>
    </div>

    <div id="quiz" class="quiz-container">
        <h2>è‹±å˜èªã‚¯ã‚¤ã‚º</h2>
        <p id="quiz-question"></p>
        <div id="quiz-feedback" class="quiz-feedback"></div>
        <div id="quiz-options" class="row">
            <div class="col-6"><button class="btn btn-outline-primary quiz-option" onclick="checkAnswer(0)"></button></div>
            <div class="col-6"><button class="btn btn-outline-primary quiz-option" onclick="checkAnswer(1)"></button></div>
            <div class="col-6"><button class="btn btn-outline-primary quiz-option" onclick="checkAnswer(2)"></button></div>
            <div class="col-6"><button class="btn btn-outline-primary quiz-option" onclick="checkAnswer(3)"></button></div>
        </div>
        <p id="quiz-score">ã‚¹ã‚³ã‚¢: 0/10</p>
        <button class="btn btn-secondary" onclick="closeQuiz()">é–‰ã˜ã‚‹</button>
        <button class="btn btn-primary" onclick="nextQuestion()">æ¬¡ã®å•é¡Œ</button>
    </div>

    <div id="effectOverlay" class="effect-overlay"></div>

    <footer>
        <p>Â© 2025 ä¸­å­¦è‹±èª å˜èªãƒ»ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§</p>
    </footer>

    <!-- Bootstrap 5.3.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        let wordData = {};
        let quizState = { score: 0, total: 10, current: null, options: [], currentIndex: 0 };
        const correctSound = new Howl({ src: ['correct.mp3'], volume: 0.6 });
        const wrongSound = new Howl({ src: ['incorrect.mp3'], volume: 0.6 });

        // Load words from words.json
        async function loadData() {
            document.getElementById('loadingModal').classList.add('active');
            try {
                const response = await fetch('words.json');
                if (!response.ok) throw new Error('å˜èªãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                wordData = await response.json();
                populateTables();
                document.getElementById('loadingModal').classList.remove('active');
            } catch (error) {
                console.error('Error loading words:', error);
                document.getElementById('loadingModal').innerHTML = `<p>å˜èªãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚words.jsonã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // Populate tables with word data
        function populateTables(filter = '') {
            const categories = [
                { id: 'nouns-table', data: wordData.nouns, key: 'word' },
                { id: 'verbs-table', data: wordData.verbs, key: 'word' },
                { id: 'adjectives-table', data: wordData.adjectives, key: 'word' },
                { id: 'adverbs-table', data: wordData.adverbs, key: 'word' },
                { id: 'prepositions-table', data: wordData.prepositions, key: 'word' },
                { id: 'phrases-table', data: wordData.phrases, key: 'phrase' }
            ];

            categories.forEach(category => {
                const table = document.getElementById(category.id);
                // Clear table except header
                while (table.rows.length > 1) table.deleteRow(1);
                const filteredData = category.data ? category.data.filter(item =>
                    item[category.key].toLowerCase().includes(filter.toLowerCase()) ||
                    item.meaning.toLowerCase().includes(filter.toLowerCase())
                ) : [];
                filteredData.forEach(item => {
                    const row = table.insertRow();
                    const cell1 = row.insertCell(0);
                    const cell2 = row.insertCell(1);
                    cell1.textContent = item[category.key];
                    cell2.textContent = item.meaning;
                    cell1.onclick = () => speak(item[category.key]);
                });
            });
        }

        // Text-to-speech
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-GB';
            speechSynthesis.speak(utterance);
        }

        // Search functionality
        function searchWords() {
            const query = document.getElementById('search').value;
            populateTables(query);
        }

        // Quiz functionality
        function startQuiz() {
            if (!wordData.nouns) {
                alert('å˜èªãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            quizState = { score: 0, total: 10, current: null, options: [], currentIndex: 0 };
            document.getElementById('quiz-score').textContent = `ã‚¹ã‚³ã‚¢: ${quizState.score}/${quizState.total}`;
            document.getElementById('quiz-feedback').textContent = '';
            document.getElementById('quiz').classList.add('active');
            nextQuestion();
        }

        function nextQuestion() {
            // Reset previous option styles
            const optionButtons = document.querySelectorAll('.quiz-option');
            optionButtons.forEach(btn => {
                btn.classList.remove('correct', 'incorrect', 'selected');
                btn.disabled = false;
            });
            document.getElementById('effectOverlay').style.display = 'none';
            document.getElementById('quiz-feedback').textContent = '';

            if (quizState.currentIndex >= quizState.total) {
                closeQuiz();
                alert(`ã‚¯ã‚¤ã‚ºçµ‚äº†ï¼ã‚¹ã‚³ã‚¢: ${quizState.score}/${quizState.total}`);
                return;
            }

            const categories = ['nouns', 'verbs', 'adjectives', 'adverbs', 'prepositions', 'phrases'];
            const category = categories[Math.floor(Math.random() * categories.length)];
            const key = category === 'phrases' ? 'phrase' : 'word';
            const items = wordData[category];
            if (!items || items.length < 4) {
                alert('é¸æŠã—ãŸã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚');
                closeQuiz();
                return;
            }

            // Select correct answer
            const correctItem = items[Math.floor(Math.random() * items.length)];
            quizState.current = { category, item: correctItem, key, index: (quizState.currentIndex || 0) + 1 };
            quizState.currentIndex = quizState.current.index;

            // Generate 3 incorrect options
            const options = [correctItem];
            const otherItems = items.filter(item => item[key] !== correctItem[key]);
            while (options.length < 4 && otherItems.length > 0) {
                const randomIndex = Math.floor(Math.random() * otherItems.length);
                options.push(otherItems.splice(randomIndex, 1)[0]);
            }

            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            quizState.options = options;

            // Update UI
            document.getElementById('quiz-question').textContent = `${correctItem.meaning} ã®è‹±èªã¯ï¼Ÿ`;
            optionButtons.forEach((btn, index) => {
                btn.textContent = options[index][key];
            });
        }

        function checkAnswer(index) {
            const selectedOption = quizState.options[index];
            const correctAnswer = quizState.current.item[quizState.current.key];
            const optionButtons = document.querySelectorAll('.quiz-option');

            // Disable all buttons after selection
            optionButtons.forEach(btn => btn.disabled = true);

            // Highlight correct and incorrect answers
            optionButtons.forEach((btn, i) => {
                if (quizState.options[i][quizState.current.key] === correctAnswer) {
                    btn.classList.add('correct');
                } else if (i === index) {
                    btn.classList.add('incorrect');
                }
            });

            // Show feedback and effects
            const isCorrect = selectedOption[quizState.current.key] === correctAnswer;
            if (isCorrect) {
                quizState.score++;
                document.getElementById('quiz-score').textContent = `ã‚¹ã‚³ã‚¢: ${quizState.score}/${quizState.total}`;
                document.getElementById('quiz-feedback').textContent = 'æ­£è§£ï¼';
                correctSound.play();
                addHeart();
                showEffect('correct');
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#0f0', '#ff0', '#fff'] });
            } else {
                document.getElementById('quiz-feedback').textContent = 'ä¸æ­£è§£ï¼';
                wrongSound.play();
                showEffect('wrong');
                showBoneAttack();
            }

            // Brief delay before next question to show feedback
            setTimeout(nextQuestion, 1800);
        }

        function showEffect(type) {
            const overlay = document.getElementById('effectOverlay');
            overlay.textContent = type === 'correct' ? 'ã€‡' : 'Ã—';
            overlay.className = `effect-overlay ${type}`;
            gsap.to(overlay, { scale: 2.5, opacity: 1, duration: 0.6, ease: "elastic.out(1, 0.3)", onStart: () => overlay.style.display = 'flex' });
            gsap.to(overlay, { scale: 3.5, opacity: 0, duration: 0.6, delay: 0.6, ease: "power2.in", onComplete: () => overlay.style.display = 'none' });
        }

        function addHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = 'ğŸ’•';
            heart.style.left = `${Math.random() * 100}vw`;
            document.body.appendChild(heart);
            gsap.to(heart, {
                y: -window.innerHeight * 2,
                opacity: 0,
                duration: 6,
                ease: "power1.out",
                onComplete: () => heart.remove()
            });
            gsap.to(heart, {
                x: 12 * (Math.random() - 0.5),
                duration: 0.6,
                repeat: -1,
                yoyo: true,
                ease: "sine.inOut"
            });
        }

        function showBoneAttack() {
            const bone = document.createElement('div');
            bone.className = 'bone-attack';
            bone.textContent = 'ğŸ¦´';
            document.getElementById('quiz').appendChild(bone);
            setTimeout(() => bone.remove(), 1000);
        }

        function handleKeydown(e) {
            const quiz = document.getElementById('quiz');
            if (!quiz.classList.contains('active')) return;

            const optionButtons = document.querySelectorAll('.quiz-option');
            let selectedIndex = Array.from(optionButtons).findIndex(btn => btn.classList.contains('selected'));

            // Navigate options with arrow keys
            if (e.key === 'ArrowUp' && selectedIndex > 1) {
                optionButtons[selectedIndex].classList.remove('selected');
                selectedIndex -= 2;
                optionButtons[selectedIndex].classList.add('selected');
            } else if (e.key === 'ArrowDown' && selectedIndex < 2) {
                optionButtons[selectedIndex].classList.remove('selected');
                selectedIndex += 2;
                optionButtons[selectedIndex].classList.add('selected');
            } else if (e.key === 'ArrowLeft' && selectedIndex % 2 === 1) {
                optionButtons[selectedIndex].classList.remove('selected');
                selectedIndex -= 1;
                optionButtons[selectedIndex].classList.add('selected');
            } else if (e.key === 'ArrowRight' && selectedIndex % 2 === 0 && selectedIndex < optionButtons.length - 1) {
                optionButtons[selectedIndex].classList.remove('selected');
                selectedIndex += 1;
                optionButtons[selectedIndex].classList.add('selected');
            } else if (e.key === 'z' || e.key === 'Enter') {
                if (selectedIndex >= 0) {
                    checkAnswer(selectedIndex);
                }
            }
        }

        function closeQuiz() {
            document.getElementById('quiz').classList.remove('active');
            document.querySelectorAll('.quiz-option').forEach(btn => btn.classList.remove('selected'));
            document.removeEventListener('keydown', handleKeydown);
        }

        // Initialize
        document.addEventListener('keydown', handleKeydown);
        loadData();
    </script>
</body>
</html>