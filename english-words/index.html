<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Learning Site</title>
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6.6.0 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap 5.3.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <script src="common.js"></script>
    <style>
        .vocab-card {
            min-height: 120px;
            max-height: 150px;
            overflow: hidden;
        }
        .vocab-icon {
            transition: transform 0.3s ease;
        }
        .vocab-icon-spin {
            animation: spin 0.5s ease-in-out;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .card-title {
            font-size: 1rem;
        }
        .card-text {
            font-size: 0.9rem;
        }

.sound-icon {
        display: inline-block !important;
        visibility: visible !important;
    }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <div class="container-md">
            <a class="navbar-brand fw-bold" href="#"><i class="fas fa-book-open me-2"></i>Vocab Fun</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active rounded px-3" href="index.php">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded px-3" href="quiz.html">Quiz</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-md my-4">
        <h1 class="text-center mb-4 fw-bold">Vocabulary Cards</h1>
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 g-2" id="cardContainer"></div>
    </div>

    <script>
        $(document).ready(function() {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå¤‰æ›´ãªã—ï¼‰
            const defaultIcons = {
                'color': 'fas fa-palette',
                'vegetable': 'fas fa-carrot',
                'fruit': 'fas fa-apple-alt',
                'shape': 'fas fa-shapes',
                'body': 'fas fa-user',
                'object': 'fas fa-pencil-alt',
                'animal': 'fas fa-paw',
                'weather': 'fas fa-cloud',
                'number': 'fas fa-sort-numeric-up',
                'place': 'fas fa-map-marker-alt',
                'action': 'fas fa-running',
                'time': 'fas fa-clock',
                'school': 'fas fa-school',
                'emotion': 'fas fa-smile',
                'fish': 'fas fa-fish',
                'meat': 'fas fa-drumstick-bite',
                'soy': 'fas fa-seedling'
            };

            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å˜èªï¼ˆå¤‰æ›´ãªã—ï¼‰
            const fallbackWords = [
                {word: "red", meaning: "èµ¤", category: "color", icon: "fas fa-circle", color: "red", background: "bg-color"},
                {word: "blue", meaning: "é’", category: "color", icon: "fas fa-circle", color: "blue", background: "bg-color"},
                {word: "apple", meaning: "ã‚Šã‚“ã”", category: "fruit", icon: "fas fa-apple-alt", background: "bg-fruit"},
                {word: "dog", meaning: "çŠ¬", category: "animal", icon: "fas fa-dog", background: "bg-animal"},
                {word: "run", meaning: "èµ°ã‚‹", category: "action", icon: "fas fa-running", background: "bg-action"},
                {word: "happy", meaning: "å¹¸ã›", category: "emotion", icon: "fas fa-smile", background: "bg-emotion"},
                {word: "school", meaning: "å­¦æ ¡", category: "school", icon: "fas fa-school", background: "bg-school"},
                {word: "sun", meaning: "å¤ªé™½", category: "weather", icon: "fas fa-sun", background: "bg-weather"},
                {word: "one", meaning: "ä¸€", category: "number", icon: "fas fa-1", background: "bg-number"},
                {word: "home", meaning: "å®¶", category: "place", icon: "fas fa-home", background: "bg-place"}
            ];

            // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ï¼ˆå¤‰æ›´ãªã—ï¼‰
            function showToast(message) {
                const toastContainer = $('<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050"></div>');
                const toast = $(`
                    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-body">${message}</div>
                    </div>
                `);
                toastContainer.append(toast);
                $('body').append(toastContainer);
                toast.toast({ delay: 3000 }).toast('show');
                setTimeout(() => toastContainer.remove(), 3500);
            }

            // éŸ³å£°èª­ã¿ä¸Šã’é–¢æ•°ï¼ˆå¤‰æ›´ãªã—ï¼‰
            function speakText(text, lang = 'en-GB') {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                const voices = speechSynthesis.getVoices();
                const selectedVoice = voices.find(voice => voice.lang === lang) ||
                                     voices.find(voice => lang === 'en-GB' ? voice.lang === 'en-US' : voice.lang === 'ja-JP') ||
                                     voices[0];
                if (!selectedVoice) {
                    showToast('éŸ³å£°ãŒä½¿ãˆã¾ã›ã‚“ã€‚ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                utterance.voice = selectedVoice;
                utterance.rate = 1;
                utterance.pitch = 1;
                utterance.volume = 1;
                utterance.onerror = (e) => console.error(`éŸ³å£°ã‚¨ãƒ©ãƒ¼: ${text} - ${e.error}`);
                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¿®æ­£ï¼è‹±èªã ã‘èª­ã¿ä¸Šã’ã‚‹ï¼‰
            function bindCardEvents() {
                $('#cardContainer').off('click touchstart').on('click touchstart', '.vocab-card', function(e) {
                    e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„èª¤ã‚¿ãƒƒãƒ—ã‚’é˜²ã
                    const $card = $(this);
                    const word = $card.data('word'); // è‹±èªã®å˜èª
                    const $icon = $card.find('.vocab-icon');
                    $icon.addClass('vocab-icon-spin'); // ã‚¢ã‚¤ã‚³ãƒ³å›è»¢
                    setTimeout(() => $icon.removeClass('vocab-icon-spin'), 500);
                    speakText(word, 'en-GB'); // è‹±èªã ã‘èª­ã¿ä¸Šã’ï¼ˆæ—¥æœ¬èªã¯å‰Šé™¤ï¼‰
                });
            }

            // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆå¤‰æ›´ãªã—ï¼‰
            function renderCards(words) {
                const cardContainer = $('#cardContainer');
                cardContainer.empty();
                words.forEach(word => {
                    const icon = word.icon || defaultIcons[word.category] || 'fas fa-question';
                    const iconStyle = word.color ? `style="color: ${word.color}"` : '';
                    const card = `
                        <div class="col">
                            <div class="card vocab-card shadow-sm ${word.background || 'bg-light'}" data-word="${word.word}">
                                <div class="card-body text-center p-2">
                                    <i class="vocab-icon ${icon} mb-1 fa-lg" ${iconStyle}></i>
                                    <h6 class="card-title fw-bold mb-1">${word.word}</h6>
                                    <p class="card-text">${word.meaning}</p>
                                    <span class="sound-icon ms-0" data-word="${word.word}">ğŸ”Š</span>
                                </div>
                            </div>
                        </div>`;
                    cardContainer.append(card);
                });
                bindCardEvents();
            }

            // éŸ³å£°åˆæœŸéç¨‹ï¼ˆå¤‰æ›´ãªã—ï¼‰
            function initializeSpeech() {
                const voices = speechSynthesis.getVoices();
                if (voices.length) {
                    bindCardEvents();
                } else {
                    showToast('éŸ³å£°ãŒæº–å‚™ã§ãã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚');
                }
            }

            // JSONèª­ã¿è¾¼ã¿ï¼ˆå¤‰æ›´ãªã—ï¼‰
            fetch('./kidswords.json')
                .then(response => {
                    if (!response.ok) throw new Error(`JSONèª­ã¿è¾¼ã¿å¤±æ•—: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    renderCards(data);
                    if (speechSynthesis.getVoices().length) {
                        initializeSpeech();
                    } else {
                        speechSynthesis.onvoiceschanged = initializeSpeech;
                    }
                })
                .catch(error => {
                    console.error('JSONèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    showToast('èªå½™ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                    renderCards(fallbackWords);
                });
        });
    </script>
</body>
</html>