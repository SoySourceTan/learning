<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç¢„Éä„Ç∞„É©„É†ËÑ≥„Éà„É¨„Éª„Ç≤„Éº„É†</title>
    
    <!-- PWAÔºà„Ç§„É≥„Çπ„Éà„Éº„É´ÂèØËÉΩ„Ç¢„Éó„É™Ôºâ„ÅÆ„Åü„ÇÅ„ÅÆË®≠ÂÆö -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="„Ç¢„Éä„Ç∞„É©„É†ËÑ≥„Éà„É¨">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    
    <script>
        const manifest = {"name":"„Ç¢„Éä„Ç∞„É©„É†ËÑ≥„Éà„É¨„Éª„Ç≤„Éº„É†","short_name":"„Ç¢„Éä„Ç∞„É©„É†ËÑ≥„Éà„É¨","start_url":".","display":"standalone","background_color":"#f0f4f8","theme_color":"#5c6bc0","description":"„Ç¢„Éä„Ç∞„É©„É†„ÅßÊ•Ω„Åó„ÅèËÑ≥„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Åå„Åß„Åç„Çã„Ç¢„Éó„É™","icons":[{"src":"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>","sizes":"192x192","type":"image/svg+xml"}]};
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        document.head.appendChild(Object.assign(document.createElement('link'), {rel: 'manifest', href: URL.createObjectURL(manifestBlob)}));
    </script>

    <style>
        :root {
            --font-family: "Hiragino Kaku Gothic ProN", "Meiryo", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --background: #f0f4f8;
            --text-color: #333;
            --card-bg: #ffffff;
            --primary-color: #5c6bc0; /* Indigo */
            --primary-hover: #3f51b5;
            --secondary-color: #ffb74d; /* Orange */
            --secondary-hover: #ffa726;
            --border-color: #dce4ec;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 20px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background: #263238;
                --text-color: #eceff1;
                --card-bg: #37474f;
                --primary-color: #7986cb;
                --primary-hover: #9fa8da;
                --secondary-color: #ffcc80;
                --secondary-hover: #ffb74d;
                --border-color: #546e7a;
            }
        }

        *, *::before, *::after { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: var(--font-family);
            background-color: var(--background);
            color: var(--text-color);
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent; /* „Çø„ÉÉ„ÉóÊôÇ„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíÊ∂à„Åô */
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* ÁîªÈù¢ÂÖ±ÈÄö */
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        /* „Éú„Çø„É≥ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        .btn {
            display: block;
            width: 100%;
            padding: 1.2rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--primary-hover); }
        .btn-secondary { background-color: var(--secondary-color); }
        .btn-secondary:hover { background-color: var(--secondary-hover); }
        .btn-subtle {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            font-size: 1.2rem;
            padding: 0.8rem;
        }

        /* --- „Çπ„Çø„Éº„ÉàÁîªÈù¢ --- */
        #start-screen h1 {
            text-align: center;
            color: var(--primary-color);
            font-size: clamp(2rem, 10vw, 3rem);
        }
        .input-wrapper {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        #inputText {
            width: 100%;
            padding: 1rem;
            font-size: 1.8rem;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }
        #candidate-list {
            list-style: none;
            padding: 0; margin: 2rem 0 0 0;
            text-align: center;
        }
        #candidate-list li {
            background-color: var(--background);
            padding: 1rem;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #candidate-list li:hover {
            transform: scale(1.05);
            background-color: var(--primary-color);
            color: white;
        }

        /* --- „ÇØ„Ç§„Ç∫ÁîªÈù¢ --- */
        #quiz-screen .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .card-container {
            perspective: 1000px;
            cursor: pointer;
        }
        .card {
            width: 100%;
            height: 300px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%; height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-size: clamp(2.5rem, 15vw, 5rem);
            font-weight: bold;
            padding: 1rem;
        }
        .card-front {
            background-color: var(--secondary-color);
            color: white;
        }
        .card-back {
            background-color: var(--card-bg);
            color: var(--primary-color);
            transform: rotateY(180deg);
        }
        .instruction { text-align: center; margin-top: 1.5rem; opacity: 0.8; }

        /* --- Â±•Ê≠¥„É¢„Éº„ÉÄ„É´ --- */
        #history-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: none; /* JS„ÅßÂà∂Âæ° */
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        #history-modal.open { display: flex; }
        .history-content {
            background-color: var(--background);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }
        .history-content h2 { margin-top: 0; text-align: center; }
        .history-list {
            list-style: none; padding: 0; margin: 0;
            overflow-y: auto; flex-grow: 1;
        }
        .history-list li {
            background-color: var(--card-bg);
            padding: 1rem; margin-bottom: 0.75rem;
            border-radius: 15px; cursor: pointer; font-size: 1.3rem;
            transition: background-color 0.3s;
        }
        .history-list li:hover { background-color: #e0e0e0; }
        .history-list small { display: block; opacity: 0.6; font-size: 0.9rem; }
        #close-history { margin-top: 1rem; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="container">
        <!-- ===== „Çπ„Çø„Éº„ÉàÁîªÈù¢ ===== -->
        <div id="start-screen" class="screen active">
            <h1>üß† „Ç¢„Éä„Ç∞„É©„É†ËÑ≥„Éà„É¨</h1>
            <div class="input-wrapper">
                <input type="text" id="inputText" placeholder="„Åì„Å®„Å∞„ÇíÂÖ•Âäõ (8ÊñáÂ≠ó„Åæ„Åß)" maxlength="8">
                <button id="generateBtn" class="btn btn-primary">ÂïèÈ°å„Çí„Å§„Åè„Çã</button>
                <ul id="candidate-list"></ul>
            </div>
            <button id="show-history" class="btn btn-subtle">Â±•Ê≠¥„ÇíË¶ã„Çã</button>
        </div>

        <!-- ===== „ÇØ„Ç§„Ç∫ÁîªÈù¢ ===== -->
        <div id="quiz-screen" class="screen">
            <div class="header">
                <button id="back-to-start" class="btn btn-subtle">„ÇÇ„Å©„Çã</button>
            </div>
            <div class="card-container">
                <div class="card">
                    <div id="card-front" class="card-face card-front"></div>
                    <div id="card-back" class="card-face card-back"></div>
                </div>
            </div>
            <p class="instruction">„Ç´„Éº„Éâ„Çí„Çø„ÉÉ„Éó„Åó„Å¶Á≠î„ÅàÂêà„Çè„ÅõÔºÅ</p>
        </div>
    </div>
    
    <!-- ===== Â±•Ê≠¥„É¢„Éº„ÉÄ„É´ ===== -->
    <div id="history-modal">
        <div class="history-content">
            <h2>„Åì„Çå„Åæ„Åß„ÅÆÂïèÈ°å</h2>
            <ul id="history-list" class="history-list"></ul>
            <button id="close-history" class="btn btn-secondary">„Å®„Åò„Çã</button>
        </div>
    </div>

    <script>
        // DOMË¶ÅÁ¥†
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const inputText = document.getElementById('inputText');
        const generateBtn = document.getElementById('generateBtn');
        const candidateList = document.getElementById('candidate-list');
        const card = document.querySelector('.card');
        const cardFront = document.getElementById('card-front');
        const cardBack = document.getElementById('card-back');
        const backToStartBtn = document.getElementById('back-to-start');
        const historyModal = document.getElementById('history-modal');
        const showHistoryBtn = document.getElementById('show-history');
        const closeHistoryBtn = document.getElementById('close-history');
        const historyList = document.getElementById('history-list');

        let history = [];

        // --- ÁîªÈù¢ÈÅ∑Áßª„É≠„Ç∏„ÉÉ„ÇØ ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // --- „Ç¢„Éä„Ç∞„É©„É†ÁîüÊàê„É≠„Ç∏„ÉÉ„ÇØ ---
        function shuffleString(s) {
            const arr = s.split('');
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr.join('');
        }

        function generateCandidates(str, count) {
            if (str.length < 2) return [];
            const resultSet = new Set();
            for (let i = 0; i < 200 && resultSet.size < count; i++) {
                const shuffled = shuffleString(str);
                if (shuffled !== str) resultSet.add(shuffled);
            }
            return Array.from(resultSet);
        }

        // --- Â±•Ê≠¥ÁÆ°ÁêÜ„É≠„Ç∏„ÉÉ„ÇØ ---
        const HISTORY_KEY = 'anagramHistory';
        const MAX_HISTORY = 20;

        function loadHistory() {
            const stored = localStorage.getItem(HISTORY_KEY);
            history = stored ? JSON.parse(stored) : [];
        }

        function saveHistory() {
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        }

        function addToHistory(original, anagram) {
            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            if (history.some(item => item.original === original && item.anagram === anagram)) return;

            history.unshift({ original, anagram }); // Êñ∞„Åó„ÅÑ„ÇÇ„ÅÆ„ÇíÂÖàÈ†≠„Å´ËøΩÂä†
            if (history.length > MAX_HISTORY) {
                history.pop(); // 20‰ª∂„ÇíË∂Ö„Åà„Åü„Çâ‰∏ÄÁï™Âè§„ÅÑ„ÇÇ„ÅÆ„ÇíÂâäÈô§
            }
            saveHistory();
        }

        // --- „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É© ---
        generateBtn.addEventListener('click', () => {
            const text = inputText.value.trim();
            if (!text) { alert('Ë®ÄËëâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }

            const candidates = generateCandidates(text, 3);
            candidateList.innerHTML = '';

            if (candidates.length === 0) {
                alert('„ÅÜ„Åæ„Åè„Ç∑„É£„ÉÉ„Éï„É´„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÂà•„ÅÆË®ÄËëâ„ÅßË©¶„Åó„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            candidates.forEach(cand => {
                const li = document.createElement('li');
                li.textContent = cand;
                li.onclick = () => {
                    startQuiz(text, cand);
                    addToHistory(text, cand);
                };
                candidateList.appendChild(li);
            });
        });
        
        function startQuiz(original, anagram) {
            card.classList.remove('is-flipped');
            setTimeout(() => {
                cardFront.textContent = anagram;
                cardBack.textContent = original;
                showScreen('quiz-screen');
            }, 100); // „Çè„Åö„Åã„Å™ÈÅÖÂª∂„Åß„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí„Çπ„É†„Éº„Ç∫„Å´
        }

        card.addEventListener('click', () => card.classList.toggle('is-flipped'));

        backToStartBtn.addEventListener('click', () => {
            showScreen('start-screen');
            inputText.value = '';
            candidateList.innerHTML = '';
        });

        showHistoryBtn.addEventListener('click', () => {
            historyList.innerHTML = '';
            if (history.length === 0) {
                const li = document.createElement('li');
                li.textContent = '„Åæ„Å†Â±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ';
                li.style.cursor = 'default';
                historyList.appendChild(li);
            } else {
                history.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `${item.anagram} <small>Ôºà„ÇÇ„Å®„ÅØ: ${item.original}Ôºâ</small>`;
                    li.onclick = () => {
                        historyModal.classList.remove('open');
                        startQuiz(item.original, item.anagram);
                    };
                    historyList.appendChild(li);
                });
            }
            historyModal.classList.add('open');
        });

        closeHistoryBtn.addEventListener('click', () => historyModal.classList.remove('open'));
        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) historyModal.classList.remove('open');
        });

        // ÂàùÊúüÂåñÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', () => {
            loadHistory();
        });
    </script>
</body>
</html>