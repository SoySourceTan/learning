<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中学受験 社会 キラキラ学習</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
        }
        header {
            background-color: #ffd700;
            padding: 20px;
            text-align: center;
        }
        header h1 {
            margin: 0;
            color: #333;
        }
        header p {
            color: #555;
        }
        nav {
            text-align: center;
            margin: 20px 0;
        }
        nav button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        nav button:hover {
            background-color: #0056b3;
        }
        .tab-content {
            display: none;
            margin: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .quiz-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            width: 80%;
            max-width: 500px;
            z-index: 1000;
        }
        .quiz-popup.active {
            display: block;
        }
        .quiz-options label {
            display: block;
            margin: 5px 0;
        }
        .quiz-popup button {
            margin: 5px;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <header>
        <h1>中学受験 社会 キラキラ学習</h1>
        <p>地理・歴史・公民・地域を楽しく学ぼう！（用語をクリックで発音、検索＆クイズ付き）</p>
    </header>

    <nav>
        <button onclick="startQuiz()">クイズを始める</button>
    </nav>

    <nav>
        <button onclick="showTab('geography')">地理</button>
        <button onclick="showTab('history')">歴史</button>
        <button onclick="showTab('civics')">公民</button>
        <button onclick="showTab('regions')">地域</button>
    </nav>

    <div id="geography" class="tab-content">
        <h2>地理</h2>
        <table>
            <thead>
                <tr><th>用語</th><th>説明</th></tr>
            </thead>
            <tbody id="geography-table"></tbody>
        </table>
        <p>注：中学受験頻出用語を収録。出典：文部科学省、中学受験テキスト。</p>
    </div>

    <div id="history" class="tab-content">
        <h2>歴史</h2>
        <table>
            <thead>
                <tr><th>用語</th><th>説明</th></tr>
            </thead>
            <tbody id="history-table"></tbody>
        </table>
        <p>注：中学受験頻出用語を収録。</p>
    </div>

    <div id="civics" class="tab-content">
        <h2>公民</h2>
        <table>
            <thead>
                <tr><th>用語</th><th>説明</th></tr>
            </thead>
            <tbody id="civics-table"></tbody>
        </table>
        <p>注：中学受験頻出用語を収録。</p>
    </div>

    <div id="regions" class="tab-content">
        <h2>地域</h2>
        <table>
            <thead>
                <tr><th>用語</th><th>説明</th></tr>
            </thead>
            <tbody id="regions-table"></tbody>
        </table>
        <p>注：中学受験頻出用語を収録。</p>
    </div>

    <div id="quiz-popup" class="quiz-popup">
        <h2>社会キラキラクイズ</h2>
        <p id="quiz-score">スコア: 0/10</p>
        <p id="quiz-question"></p>
        <div id="quiz-options" class="quiz-options"></div>
        <button onclick="checkAnswer()">回答</button>
        <button onclick="closeQuiz()">閉じる</button>
        <button onclick="nextQuestion()">次の問題</button>
    </div>

    <footer>
        <p>© 2025 中学受験 社会 キラキラ学習</p>
    </footer>

    <script>
        // JSONファイルのURL（同じディレクトリ）
        const jsonFiles = {
            geography: './geography.json',
            history: './history.json',
            civics: './civics.json',
            regions: './regions.json'
        };

        // 全データを保存
        let allData = {
            geography: [],
            history: [],
            civics: [],
            regions: []
        };

        // クイズ用の変数
        let quizData = [];
        let currentQuestion = null;
        let score = 0;
        let questionCount = 0;
        const maxQuestions = 10;

        // JSONを読み込んで表に表示
        async function loadJson(category, tableId) {
            try {
                const response = await fetch(jsonFiles[category]);
                if (!response.ok) throw new Error(`${category}の読み込みに失敗`);
                const data = await response.json();
                allData[category] = data;

                const tableBody = document.getElementById(tableId);
                tableBody.innerHTML = '';
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td onclick="speak('${item.term}')">${item.term}</td>
                        <td>${item.description}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('エラー:', error);
                document.getElementById(tableId).innerHTML = '<tr><td colspan="2">データの読み込みに失敗しました</td></tr>';
            }
        }

        // タブ切り替え
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // 音声読み上げ
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            speechSynthesis.speak(utterance);
        }

        // クイズ開始
        function startQuiz() {
            quizData = [];
            for (let category in allData) {
                quizData.push(...allData[category].map(item => ({ ...item, category })));
            }
            if (quizData.length < 4) {
                alert('データが不足しています。');
                return;
            }
            score = 0;
            questionCount = 0;
            document.getElementById('quiz-score').textContent = `スコア: ${score}/${maxQuestions}`;
            document.getElementById('quiz-popup').classList.add('active');
            nextQuestion();
        }

        // 次の問題
        function nextQuestion() {
            if (questionCount >= maxQuestions) {
                alert(`クイズ終了！スコア: ${score}/${maxQuestions}`);
                closeQuiz();
                return;
            }
            currentQuestion = quizData[Math.floor(Math.random() * quizData.length)];
            const categoryData = allData[currentQuestion.category].filter(item => item.term !== currentQuestion.term);
            const wrongAnswers = [];
            while (wrongAnswers.length < 3 && categoryData.length > 0) {
                const index = Math.floor(Math.random() * categoryData.length);
                wrongAnswers.push(categoryData.splice(index, 1)[0].term);
            }
            const options = [currentQuestion.term, ...wrongAnswers].sort(() => Math.random() - 0.5);

            document.getElementById('quiz-question').textContent = `(${currentQuestion.category}) ${currentQuestion.description}`;
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = options.map(option => `
                <label>
                    <input type="radio" name="quiz-option" value="${option}">
                    ${option}
                </label>
            `).join('');
            questionCount++;
        }

        // 回答チェック
        function checkAnswer() {
            const selectedOption = document.querySelector('input[name="quiz-option"]:checked');
            if (!selectedOption) {
                alert('選択してください。');
                return;
            }
            const userAnswer = selectedOption.value;
            if (userAnswer === currentQuestion.term) {
                score++;
                alert('正解！');
            } else {
                alert(`不正解。正解は「${currentQuestion.term}」です。`);
            }
            document.getElementById('quiz-score').textContent = `スコア: ${score}/${maxQuestions}`;
            nextQuestion();
        }

        // クイズ閉じる
        function closeQuiz() {
            document.getElementById('quiz-popup').classList.remove('active');
        }

        // ページ読み込み時にJSONを読み込む
        window.onload = () => {
            loadJson('geography', 'geography-table');
            loadJson('history', 'history-table');
            loadJson('civics', 'civics-table');
            loadJson('regions', 'regions-table');
            showTab('geography');
        };
    </script>
</body>
</html>
